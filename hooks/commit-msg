#!/bin/bash

# Conventional commit message hook
# Enforces: lowercase, ≤40 chars first line, starts with type: like feat:, fix:, etc.

COMMIT_MSG_FILE=$1
COMMIT_MSG=$(head -n1 "$COMMIT_MSG_FILE")

# Allowed types
TYPES="feat|fix|docs|style|refactor|test|chore|perf|ci|build|revert"

# Check if starts with type:
if ! echo "$COMMIT_MSG" | grep -qE "^($TYPES):"; then
  echo "Error: Commit message must start with a type: $TYPES:"
  exit 1
fi

# Check if lowercase
if [[ "$COMMIT_MSG" =~ [A-Z] ]]; then
  echo "Error: Commit message first line must be lowercase"
  exit 1
fi

# Check length ≤40
if [ ${#COMMIT_MSG} -gt 40 ]; then
  echo "Error: Commit message first line must be ≤40 characters"
  exit 1
fi

echo "Commit message is valid"